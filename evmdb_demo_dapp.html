<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>EVMDB Demo</title>
	<link rel="stylesheet" href="evmdb.css">
	<script src="js/bignumber.min.js"></script>
	<script src="js/web3-light.js"></script>

	<script>
		var Web3 = require('web3');
		var web3 = new Web3();
		web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));

		// let's assume that coinbase is our account
		web3.eth.defaultAccount = web3.eth.coinbase;
	</script>

	<script src="deployment.js"></script>
	<script type='text/javascript'>
		function create() {
			var name = document.getElementById('create_DB').value;
			var header1 = document.getElementById('create_header1').value;
			var header2 = document.getElementById('create_header2').value;
			var res = contracts['EVMDB'].contract.create(name, [header1, header2]);
		}

		function insert() {
			var name = document.getElementById('insert_DB').value;
			var field1 = document.getElementById('insert_field1').value;
			var field2 = document.getElementById('insert_field2').value;
			var res = contracts['EVMDB'].contract.insert(name, [field1, field2]);
		}

		function update() {
			var name = document.getElementById('update_DB').value;
			var row = document.getElementById('update_row').value;
			var field1 = document.getElementById('update_field1').value;
			var field2 = document.getElementById('update_field2').value;
			var res = contracts['EVMDB'].contract.update(name, row, [field1, field2]);
		}

		function erase() {
			var name = document.getElementById('erase_DB').value;
			var row = document.getElementById('erase_row').value;
			var res = contracts['EVMDB'].contract.erase(name, row);
		}

		function search() {
			var name = document.getElementById('search_DB').value;
			var value = document.getElementById('search_value').value;
			var res = contracts['EVMDB'].contract.search(name, value);
			res = web3.toDecimal(res);
			if (res == -1) {
				document.getElementById('search_res').innerText = "not found";
			} else {
				var row_res = contracts['EVMDB'].contract.get_data(name, res);
				row_res[0] = web3.toAscii(row_res[0]);
				row_res[1] = web3.toAscii(row_res[1]);
				document.getElementById('search_res').innerText = row_res[0] + ", " + row_res[1];
			}
		}

		function get_keys() {
			var DB_id = document.getElementById('DB_id_key').value;
			var row_id = document.getElementById('row_id_key').value;
			var res = contracts['EVMDB'].contract.get_keys(DB_id, row_id);
			//res = web3.toAscii(res);
			document.getElementById('queryres').innerText = res;
		}

		function show_header() {
			var DB_id = document.getElementById('DB_id_header').value;
			var row_id = document.getElementById('row_id_header').value;
			var res = contracts['EVMDB'].contract.get_header(DB_id, row_id);
			res = web3.toAscii(res);
			document.getElementById('queryres').innerText = res;
		}

		function get_data_from_DB() {
			var DB_id = document.getElementById('DB_id_data').value;
			var row_id = document.getElementById('row_id').value;
			var res = contracts['EVMDB'].contract.get_data(DB_id, row_id);
			res[0] = web3.toAscii(res[0]);
			res[1] = web3.toAscii(res[1]);
			document.getElementById('queryres').innerText = res[0] + "," + res[1];
		}

		function show_DBs_list() {
			var DB_id = document.getElementById('show_DB_id').value;
			var DB_size = contracts['EVMDB'].contract.get_DB_info(DB_id);
			var i, j;
			var row;
			var table_html = "<table> ";
			for (i = 0; i < DB_size; i++) {
				table_html = table_html + "<tr>";
				row = contracts['EVMDB'].contract.get_data(DB_id, i);
				for (j = 0; j < row.length; j++) {
					table_html = table_html + "<td>" + web3.toAscii(row[j]) + "</td>";
				}
				table_html = table_html + "<tr>";
			}
			table_html = table_html + "</table>";
			document.getElementById('DBs_list').innerHTML = table_html;
		}

		function show_DB() {
			var DB_id = document.getElementById('show_DB_id').value;
			var DB_size = contracts['EVMDB'].contract.get_DB_info(DB_id);
			DB_size = DB_size[2];
			var i, j;
			var row;
			var table_html = "<table> ";
			for (i = 0; i < table_size; i++) {
				row = contracts['EVMDB'].contract.get_row(DB_id, i);
				if ( (row[0] != 0) || (row[1] != 0) ) { //deleted row are all zeros
					table_html = table_html + "<tr>";
					for (j = 0; j < row.length; j++) {
						table_html = table_html + "<td>" + web3.toAscii(row[j]) + "</td>";
					}
					table_html = table_html + "<tr>";
				}
			}
			table_html = table_html + "</table>";
			document.getElementById('table').innerHTML = table_html;
		}

		var createEvent = contracts['EVMDB'].contract.DBCreated(function (error, result) {
			if (!error) {
				document.getElementById('created_DB_id').innerText = "A DB with ID " + JSON.stringify(result.args.index) + " was created";
			} else {
				document.getElementById('created_DB_id').innerText = "error";
			}
		});
	</script>
</head>

<body>
<h1> EVMDB Demo </h1>
	<div class="container_wide">
		<div class="container">
			<h3>Network Chain</h3>
			<fieldset>
				<select name="network_chain"  onChange="alert('Craig is the best!!!');">
					<option value="mainnet">ETH mainnet</option>
					<option value="testnet">ETH testnet</option>
					<option value="classic">ETC mainnet</option>
				</select>
			</fieldset>
		</div>
	</div>
		
	<div class="container_wide">
		<div class="container">
			<h3>Create DB</h3>
			<fieldset>
				<input type='text' id='create_DB' placeholder="DB Name" maxlength="8" size="8" tabindex="1">
			</fieldset>
			<fieldset>
				<input type='text' id='create_header1' placeholder="Header1" size="10" tabindex="2">
				<input type='text' id='create_header2' placeholder="Header2" size="10" tabindex="3">
			</fieldset>
			<fieldset>
				<button onclick='create()'>Create</button> <div id="created_DB_id"> A DB with ID x was created </div>
			</fieldset>
		</div>

		<div class="container">
			<h4>Insert</h4>
			<fieldset>
				<label>DB ID:</label>
				<input type='text' id='insert_DB' placeholder="DB ID" value="0" maxlength="4" size="4">
			</fieldset>
			<fieldset>
				<input type='text' id='insert_field1' placeholder="Field 1" size="10">
				<input type='text' id='insert_field2' placeholder="Field 2" size="10">
			</fieldset>
			<fieldset>
				<button onclick='insert()'>Insert</button>
			</fieldset>
		</div>
		
		<div class="container">
			<h4>Update</h4>
			<fieldset>
				<label>DB ID:</label>
				<input type='text' id='update_DB' value="0" maxlength="4" size="4">
				<label>Row:</label>
				<input type='text' id='update_row' value="0" maxlength="4" size="4">
			</fieldset>
			<fieldset>
				<input type='text' id='update_field1' placeholder="field 1" size="10">
				<input type='text' id='update_field2' placeholder="field 2" size="10">
			</fieldset>
			<fieldset>
				<button onclick='update()'>Update</button>
			</fieldset>
		</div>
	
		<div class="container">
			<h4>Search</h4>
			<fieldset>
				<label>DB ID:</label>
				<input type='text' id='search_DB' value="0" maxlength="4" size="4">
				<input type='text' id='search_value' placeholder="Search for" value="" size="12">
			</fieldset>
			<fieldset>
				<button onclick='erase()'>Search</button>
			</fieldset>
			<fieldset>
				<div id='search_res'>result here</div>
			</fieldset>
		</div>
	
		<div class="container">
			<h4>Erase</h4>
			<fieldset>
				<label>DB ID:</label>
				<input type='text' id='erase_DB' value="0" maxlength="4" size="4">
				<label>Row:</label>
				<input type='text' id='erase_row' value="0" maxlength="4" size="4">
			</fieldset>
			<fieldset>
				<button onclick='erase()'>Erase</button>
			</fieldset>
		</div>
	</div>

	<div class="container_wide">
		<div class="container">
			<h3>DBs List</h3>
			<fieldset>
				<textarea id='DBs_list' rows="10" cols="20" disabled></textarea>
			</fieldset>
		</div>
	
		<div class="container">
			<h3>DB View</h3>
			<fieldset>
				<label>DB ID:</label>
				<input type='text' id='show_DB_id' value="0" maxlength="4" size="4">
				<button onclick='show_DB()'>Show DB</button>
			</fieldset>
		</div>
		<div id='table'>output
			<table>
				<tr>
					<th>Header 1</th>
					<th>Header 2</th>
				</tr>
				<tr>
					<td>Data 1</td>
					<td>Data 2</td>
				</tr>
			</table>
		</div>
	</div>

</body>

</html>
